# Структура базы данных и ручное редактирование

Бот использует SQLite-файл (по умолчанию `db.sqlite3` из корня проекта). Работа с базой
инкапсулирована в модуле [`cleaning_bot/database.py`](../cleaning_bot/database.py).

## Таблицы

### `users`

| Поле         | Тип      | Назначение                                           |
|--------------|----------|-------------------------------------------------------|
| `telegram_id`| INTEGER  | Первичный ключ, Telegram ID пользователя.             |
| `name`       | TEXT     | Отображаемое имя участника.                           |

Таблица служит справочником пользователей и заполняется автоматически на старте
бота при синхронизации с `users.json`.

### `assignments`

| Поле          | Тип     | Назначение                                                                 |
|---------------|---------|-----------------------------------------------------------------------------|
| `id`          | INTEGER | Первичный ключ (AUTOINCREMENT).                                            |
| `task_date`   | TEXT    | Дата задачи в формате ISO (`YYYY-MM-DD`).                                  |
| `user_id`     | INTEGER | Ссылка на `users.telegram_id`.                                             |
| `room`        | TEXT    | Название комнаты или зоны.                                                 |
| `level`       | TEXT    | Уровень уборки (минимум, лёгкая, обычная, расширенная, генеральная).       |
| `description` | TEXT    | Конкретное задание для пользователя.                                       |
| `completed`   | INTEGER | Флаг выполнения (`0` — не выполнено, `1` — выполнено).                     |
| `completed_at`| TEXT    | Временная метка завершения в формате ISO или `NULL`, если не выполнено.    |

Уникальный индекс (`task_date`, `user_id`, `room`, `level`, `description`) защищает от дубликатов.

## Ручное редактирование через `sqlite3`

1. Убедитесь, что бот остановлен, чтобы избежать конфликтов соединений.
2. Запустите интерактивную консоль SQLite, указав путь к базе:

   ```bash
   sqlite3 db.sqlite3
   ```

3. Внутри консоли можно просмотреть имеющиеся таблицы и их схему:

   ```sql
   .tables
   .schema assignments
   ```

### Пример: удалить статистику за день

Допустим, нужно убрать все записи за 15 октября 2025 года. Выполните команду:

```sql
DELETE FROM assignments WHERE task_date = '2025-10-15';
```

### Пример: добавить статистику за прошедший день

Чтобы вручную добавить выполненное задание за 14 октября 2025 года для пользователя с
`telegram_id = 356856662`, используйте вставку (поля `room`, `level` и `description`
должны соответствовать формату, который использует бот):

```sql
INSERT INTO assignments (task_date, user_id, room, level, description, completed, completed_at)
VALUES (
  '2025-10-14',
  356856662,
  'Кухня',
  'обычная',
  'Вымыть столешницы и плиту',
  1,
  '2025-10-14T21:30:00'
);
```

> **Совет.** Если добавляете невыполненное задание, задайте `completed = 0` и оставьте
`completed_at` равным `NULL` (`NULL` указывается без кавычек).

4. По завершении введите `.quit`, чтобы закрыть консоль.

После ручных правок перезапустите бота. Он автоматически прочитает обновлённые данные
из базы и продолжит работу.
